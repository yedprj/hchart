<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/layout">

    <th:block layout:fragment="content">
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=558649a8e9e0b86817f410748025186f"></script>

        <style>
            .wrap {position: absolute;left: 0;bottom: 40px;width: 288px;height: 120px;margin-left: -144px;text-align: left;overflow: hidden;font-size: 12px;font-family: 'Malgun Gothic', dotum, '돋움', sans-serif;line-height: 1.5;}
            .wrap * {padding: 0;margin: 0;}
            .wrap .info {width: 286px;height: 120px;border-radius: 5px;border-bottom: 2px solid #ccc;border-right: 1px solid #ccc;overflow: hidden;background: #fff;}
            .wrap .info:nth-child(1) {border: 0;box-shadow: 0px 1px 2px #888;}
            .info .title {padding: 5px 0 0 10px;height: 30px;background: #eee;border-bottom: 1px solid #ddd;font-size: 18px;font-weight: bold;}
            .info .close {position: absolute;top: 10px;right: 10px;color: #888;width: 17px;height: 17px;background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/overlay_close.png');}
            .info .close:hover {cursor: pointer;}
            .info .body {position: relative;overflow: hidden;}
            .info .desc {position: relative;margin: 13px 0 0 10px;height: 75px;}
            .desc .ellipsis {overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
            .desc .jibun {font-size: 11px;color: #888;margin-top: -2px;}
            .info:after {content: '';position: absolute;margin-left: -12px;left: 50%;bottom: 0;width: 22px;height: 12px;background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png')}
        </style>

        <div class="page-header min-height-400 border-radius-xl mt-4"
             style="background-image: url('https://img.freepik.com/free-vector/doctor-hand-vaccinating-multi-generation-family-patients-in-medical-mask-fight-against-coronavirus-vaccine-development_48369-42253.jpg?w=1800');">
            <span class="mask  bg-gradient-primary  opacity-6"></span>
        </div>
        <div class="card card-body mx-3 mx-md-4 mt-n6 align-content-center">
            <div id="map" style="width: 800px; height: 800px"></div>
        </div>

        <script>
            let mapContainer = document.getElementById('map'),
                mapOption = {
                    center : new kakao.maps.LatLng(35.95, 128.25),
                    level : 12
                };

            let map = new kakao.maps.Map(mapContainer, mapOption);

            let marker;
            let overlay;

            let data1 = [];
            $.ajax({
                url : "/chart/centerMarker",
                type : "GET",
                dataType : "text",
                async: false,
                success : function (result) {
                    let resultParse = JSON.parse(result);

                    data1 = resultParse.data;

                    console.log(resultParse.data);
                }
            });

            console.log(data1);

            for (let i in data1) {
                let lat = data1[i].lat;
                let lng = data1[i].lng;

                marker = new kakao.maps.Marker({
                    map : map,
                    position: new kakao.maps.LatLng(lat, lng)
                });

                let content = '<div class="wrap">' +
                    '    <div class="info">' +
                    '        <div class="title">' +
                    '            '+ data1[i].facilityName +'' +
                    '            <div class="close" onclick="closeOverlay()" title="닫기"></div>' +
                    '        </div>' +
                    '        <div class="body">' +
                    '            <div class="desc">' +
                    '                <div class="ellipsis">'+data1[i].address+'</div>' +
                    '                <div class="jibun ellipsis">'+ data1[i].centerName +'</div>' +
                    '                <div class="phoneNumber">'+ data1[i].phoneNumber+'</div>' +
                    '            </div>' +
                    '        </div>' +
                    '    </div>' +
                    '</div>';

                // 마커 위에 커스텀 오버레이를 표시
                // 마커를 중심으로 커스텀 오버레이를 표시하기 위해 css를 이용해 위치 설정
                overlay = new kakao.maps.CustomOverlay({
                    content : content,
                    map : map,
                    position : new kakao.maps.LatLng(lat, lng)
                });

                // 마커를 클릭했을 때 커스텀 오버레이를 표시
                kakao.maps.event.addListener(marker, 'click', displayOverlay(map, overlay));

            }

            // 커스텀 오버레이를 닫기 위해 호출되는 함수입니다
            function closeOverlay() {
                overlay.setMap(null);
            }

            function displayOverlay(map, overlay) {
                return function() {
                    overlay.setMap(map);
                }
            }
        </script>
    </th:block>
</html>